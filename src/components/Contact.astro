---
import Mail from "../icons/Mail.astro";
---

<div class="w-full">
  <form 
    id="contact-form"
    class="flex flex-col gap-4 max-w-xl mx-auto"
    action="https://formspree.io/f/xrblrbzq" 
    method="POST"
  >
    <div class="flex flex-col gap-1">
      <label for="name" class="text-sm font-medium">Nombre</label>
      <input
        type="text"
        id="name"
        name="name"
        required
        class="bg-neutral-900 border border-neutral-700 rounded-lg p-3 focus:outline-none focus:ring-2 focus:ring-blue-500 transition"
        placeholder="Tu nombre"
      />
    </div>

    <div class="flex flex-col gap-1">
      <label for="email" class="text-sm font-medium">Email</label>
      <input
        type="email"
        id="email"
        name="email"
        required
        class="bg-neutral-900 border border-neutral-700 rounded-lg p-3 focus:outline-none focus:ring-2 focus:ring-blue-500 transition"
        placeholder="tu@email.com"
      />
    </div>

    <div class="flex flex-col gap-1">
      <label for="message" class="text-sm font-medium">Mensaje</label>
      <textarea
        id="message"
        name="message"
        required
        rows="5"
        class="bg-neutral-900 border border-neutral-700 rounded-lg p-3 focus:outline-none focus:ring-2 focus:ring-blue-500 transition resize-none"
        placeholder="¿En qué puedo ayudarte?"
      ></textarea>
    </div>

    <input type="text" name="_gotcha" style="display:none" />
    
    <input type="hidden" name="_next" value="https://tu-portfolio.com/?success=true" />

    <div id="form-status" class="hidden text-sm py-2 px-4 rounded-lg">
   
    </div>

    <button
      type="submit"
      id="submit-button"
      class="bg-blue-600 hover:bg-blue-700 text-white font-medium py-3 px-6 rounded-lg transition-colors mt-2 flex items-center justify-center gap-2"
    >
      <Mail class="size-5" />
      <span id="button-text">Enviar mensaje</span>
    </button>
  </form>
</div>

<script>
  // Obtener referencias a elementos del DOM
  const form = document.getElementById('contact-form');
  const formStatus = document.getElementById('form-status');
  const submitButton = document.getElementById('submit-button');
  const buttonText = document.getElementById('button-text');
  
  // Manejar el envío del formulario
  if (form) {
    form.addEventListener('submit', async (event) => {
      // Deshabilitar el botón y mostrar estado de carga
      if (submitButton && buttonText) {
        //submitButton.disabled = true;
        buttonText.textContent = 'Enviando...';
      }
      
      if (formStatus) {
        showStatus('Enviando mensaje...', 'info');
      }
    });
  }
  
  // Detectar cuando el formulario se ha enviado correctamente
  window.onload = function() {
    const urlParams = new URLSearchParams(window.location.search);
    if (urlParams.has('success')) {
      showStatus('¡Mensaje enviado con éxito! Me pondré en contacto contigo pronto.', 'success');
     // if (form) form.reset();
    }
  };
  
  function showStatus(message: string, type: 'success' | 'error' | 'info') {
    if (!formStatus) return;
    
    formStatus.textContent = message;
    formStatus.classList.remove('hidden', 'bg-green-500/20', 'bg-red-500/20', 'bg-blue-500/20');
    
    switch (type) {
      case 'success':
        formStatus.classList.add('bg-green-500/20', 'text-green-200');
        break;
      case 'error':
        formStatus.classList.add('bg-red-500/20', 'text-red-200');
        break;
      case 'info':
        formStatus.classList.add('bg-blue-500/20', 'text-blue-200');
        break;
    }
  }
</script>